<!DOCTYPE html>
<html lang="pt-BR">
<head>
ย ย <meta charset="UTF-8">
ย ย <meta name="viewport" content="width=device-width, initial-scale=1.0">
ย ย <title>Gerenciar Cardรกpio - Dona Baguete</title>
ย ย <style>
ย ย ย ย * { margin: 0; padding: 0; box-sizing: border-box; }
ย ย ย ย body {
ย ย ย ย ย ย font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
ย ย ย ย ย ย background: linear-gradient(to bottom, #000000 0%, #1a1a2e 100%);
ย ย ย ย ย ย color: #ffffff;
ย ย ย ย ย ย min-height: 100vh;
ย ย ย ย ย ย padding: 20px;
ย ย ย ย }

ย ย ย ย /* --- NAV ADMIN --- */
ย ย ย ย .admin-nav {
ย ย ย ย ย ย background: #111827;
ย ย ย ย ย ย padding: 12px 20px;
ย ย ย ย ย ย margin: -20px -20px 20px -20px;ย
ย ย ย ย ย ย border-bottom: 2px solid #d4a021;
ย ย ย ย ย ย display: flex;
ย ย ย ย ย ย gap: 10px;
ย ย ย ย ย ย align-items: center;
ย ย ย ย ย ย flex-wrap: wrap;
ย ย ย ย }
ย ย ย ย .nav-btn {
ย ย ย ย ย ย background: #374151;
ย ย ย ย ย ย color: #f3f4f6;
ย ย ย ย ย ย border: none;
ย ย ย ย ย ย padding: 10px 15px;
ย ย ย ย ย ย border-radius: 8px;
ย ย ย ย ย ย font-weight: bold;
ย ย ย ย ย ย font-size: 0.9rem;
ย ย ย ย ย ย cursor: pointer;
ย ย ย ย ย ย text-decoration: none;ย
ย ย ย ย ย ย transition: all 0.3s;
ย ย ย ย ย ย font-family: inherit;ย
ย ย ย ย }
ย ย ย ย .nav-btn:hover {
ย ย ย ย ย ย background: #4b5563;
ย ย ย ย }
ย ย ย ย .nav-btn.active {
ย ย ย ย ย ย background: #d4a021;
ย ย ย ย ย ย color: #000;
ย ย ย ย }
ย ย ย ย .nav-btn.logout {
ย ย ย ย ย ย background: #dc2626;ย
ย ย ย ย ย ย color: #fff;
ย ย ย ย ย ย margin-left: auto;ย
ย ย ย ย }
        .nav-btn.logout a { color: inherit; text-decoration: none;}

ย ย ย ย /* --- FIM DA NAV --- */

ย ย ย ย .container {
ย ย ย ย ย ย max-width: 1000px;
ย ย ย ย ย ย margin: 0 auto;
ย ย ย ย }
ย ย ย ย .header {
ย ย ย ย ย ย text-align: center;
ย ย ย ย ย ย margin-bottom: 20px;
ย ย ย ย ย ย border-bottom: 2px solid #d4a021;
ย ย ย ย ย ย padding-bottom: 20px;
ย ย ย ย }
ย ย ย ย .header h1 {
ย ย ย ย ย ย font-size: 2rem;
ย ย ย ย ย ย font-weight: bold;
ย ย ย ย ย ย color: #d4a021;
ย ย ย ย }

ย ย ย ย .cardapio-manager {
ย ย ย ย ย ย display: grid;
ย ย ย ย ย ย grid-template-columns: 1fr;
ย ย ย ย ย ย gap: 20px;
ย ย ย ย }
ย ย ย ย @media (min-width: 768px) {
ย ย ย ย ย ย .cardapio-manager {
ย ย ย ย ย ย ย ย grid-template-columns: 1fr 1fr;
ย ย ย ย ย ย }
ย ย ย ย }
ย ย ย ย .cardapio-coluna {
ย ย ย ย ย ย background: linear-gradient(145deg, #2d3748, #1a202c);
ย ย ย ย ย ย border-radius: 16px;
ย ย ย ย ย ย padding: 25px;
ย ย ย ย }
ย ย ย ย .coluna-header {
ย ย ย ย ย ย display: flex;
ย ย ย ย ย ย justify-content: space-between;
ย ย ย ย ย ย align-items: center;
ย ย ย ย ย ย margin-bottom: 20px;
ย ย ย ย }
ย ย ย ย .coluna-header h2 {
ย ย ย ย ย ย font-size: 1.5rem;
ย ย ย ย ย ย color: #d4a021;
ย ย ย ย }
ย ย ย ย .btn-add {
ย ย ย ย ย ย background: #10b981;
ย ย ย ย ย ย color: #fff;
ย ย ย ย ย ย border: none;
ย ย ย ย ย ย padding: 10px 15px;
ย ย ย ย ย ย font-size: 1rem;
ย ย ย ย ย ย font-weight: bold;
ย ย ย ย ย ย border-radius: 8px;
ย ย ย ย ย ย cursor: pointer;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย .item-card {
ย ย ย ย ย ย background: #374151;
ย ย ย ย ย ย padding: 15px;
ย ย ย ย ย ย border-radius: 10px;
ย ย ย ย ย ย margin-bottom: 10px;
ย ย ย ย ย ย box-shadow: 0 4px 12px rgba(0,0,0,0.3);
ย ย ย ย ย ย border-left: 4px solid #d4a021;
ย ย ย ย ย ย display: flex;
ย ย ย ย ย ย justify-content: space-between;
ย ย ย ย ย ย align-items: center;
ย ย ย ย }
ย ย ย ย .item-card.pausado {
ย ย ย ย ย ย border-left-color: #ef4444;
ย ย ย ย ย ย opacity: 0.6;
ย ย ย ย }
ย ย ย ย .item-info .nome {
ย ย ย ย ย ย font-size: 1.1rem;
ย ย ย ย ย ย font-weight: bold;
ย ย ย ย ย ย color: #fff;
ย ย ย ย }
ย ย ย ย .item-info .pausado-tag {
ย ย ย ย ย ย font-size: 0.8rem;
ย ย ย ย ย ย font-weight: bold;
ย ย ย ย ย ย color: #ef4444;
ย ย ย ย ย ย margin-left: 5px;
ย ย ย ย }
ย ย ย ย .item-info .preco {
ย ย ย ย ย ย font-size: 1rem;
ย ย ย ย ย ย color: #9ca3af;
ย ย ย ย }
ย ย ย ย .btn-edit {
ย ย ย ย ย ย background: #d4a021;
ย ย ย ย ย ย color: #000;
ย ย ย ย ย ย border: none;
ย ย ย ย ย ย padding: 10px 15px;
ย ย ย ย ย ย border-radius: 8px;
ย ย ย ย ย ย font-weight: bold;
ย ย ย ย ย ย cursor: pointer;
ย ย ย ย }
ย ย ย ย #loading-msg {
ย ย ย ย ย ย text-align: center;
ย ย ย ย ย ย font-size: 1.2rem;
ย ย ย ย ย ย color: #d4a021;
ย ย ย ย ย ย padding: 40px;
ย ย ย ย }

ย ย ย ย /* --- ESTILOS DO MODAL --- */
ย ย ย ย .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 200; overflow-y: auto; }
ย ย ย ย .modal.active { display: flex; justify-content: center; align-items: center; padding: 20px; }
ย ย ย ย .modal-content { background: linear-gradient(145deg, #2d3748, #1a202c); border-radius: 20px; max-width: 600px; width: 100%; max-height: 90vh; overflow-y: auto; border: 2px solid #d4a021; }
ย ย ย ย .modal-header { background: #000; padding: 20px; border-bottom: 2px solid #d4a021; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 10; }
ย ย ย ย .modal-title { font-size: 1.5rem; font-weight: bold; color: #d4a021; }
ย ย ย ย .close-btn { background: #dc2626; color: #fff; border: none; padding: 10px 20px; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 1.1rem; }
ย ย ย ย .modal-body { padding: 25px; }
ย ย ย ย .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
ย ย ย ย .input-group { display: flex; flex-direction: column; }
ย ย ย ย .full-width { grid-column: 1 / -1; }
ย ย ย ย .input-group label { margin-bottom: 8px; color: #9ca3af; font-weight: bold; }
ย ย ย ย .input-field { background: #374151; color: #fff; border: 2px solid #4b5563; border-radius: 8px; padding: 12px; font-size: 1rem; font-family: inherit; }
ย ย ย ย .input-field:focus { outline: none; border-color: #d4a021; }
ย ย ย ย textarea.input-field { resize: vertical; min-height: 80px; }
ย ย ย ย .checkbox-group { display: flex; align-items: center; gap: 10px; background: #374151; padding: 12px; border-radius: 8px; }
ย ย ย ย .checkbox-group input { width: 18px; height: 18px; }
ย ย ย ย .checkbox-group label { margin: 0; color: #fff; }
ย ย ย ย .options-title { font-size: 1.1rem; font-weight: bold; color: #d4a021; margin: 20px 0 10px 0; }
ย ย ย ย .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
ย ย ย ย .modal-footer { padding: 20px; background: #1a202c; display: flex; justify-content: space-between; gap: 10px; position: sticky; bottom: 0; }
ย ย ย ย .modal-footer button { flex: 1; padding: 15px; border: none; border-radius: 10px; font-weight: bold; font-size: 1rem; cursor: pointer; }
ย ย ย ย .btn-delete { background: #dc2626; color: #fff; }
ย ย ย ย .btn-save { background: #10b981; color: #fff; }
ย ย </style>
</head>
<body>

ย ย <div class="admin-nav">
ย ย ย ย <a href="cozinha.html" class="nav-btn">๐ณ Cozinha</a>
ย ย ย ย <a href="manual.html" class="nav-btn">โ๏ธ Pedido Manual</a>
ย ย ย ย <a href="caixa.html" class="nav-btn">๐ Caixa</a>
ย ย ย ย <a href="admin.html" class="nav-btn">โ๏ธ Admin</a>
ย ย ย ย <a href="cardapio.html" class="nav-btn active">๐ Cardรกpio</a>
ย ย ย ย <a href="login.html" class="nav-btn logout">Entrar (Admin) โ</a> 
ย ย </div>
ย ย <div class="container">
ย ย ย ย <div class="header">
ย ย ย ย ย ย <h1>๐ Gerenciar Cardรกpio</h1>
ย ย ย ย </div>

ย ย ย ย <div id="loading-msg">Carregando cardรกpio...</div>

ย ย ย ย <div class="cardapio-manager" style="display: none;">
ย ย ย ย ย ย <div class="cardapio-coluna">
ย ย ย ย ย ย ย ย <div class="coluna-header">
ย ย ย ย ย ย ย ย ย ย <h2>๐ฅ Lanches</h2>
ย ย ย ย ย ย ย ย ย ย <button class="btn-add" onclick="openModal('lanche')">+ Adicionar Lanche</button>
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย <div id="lanches-lista">
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย </div>
ย ย ย ย ย ยย
ย ย ย ย ย ย <div class="cardapio-coluna">
ย ย ย ย ย ย ย ย <div class="coluna-header">
ย ย ย ย ย ย ย ย ย ย <h2>๐ฅค Bebidas</h2>
ย ย ย ย ย ย ย ย ย ย <button class="btn-add" onclick="openModal('bebida')">+ Adicionar Bebida</button>
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย <div id="bebidas-lista">
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย </div>
ย ย ย ย </div>
ย ย </div>

ย ย <div class="modal" id="modal">
ย ย ย ย <div class="modal-content">
ย ย ย ย ย ย <div class="modal-header">
ย ย ย ย ย ย ย ย <h2 class="modal-title" id="modal-title">Editar Item</h2>
ย ย ย ย ย ย ย ย <button class="close-btn" onclick="closeModal()">โ</button>
ย ย ย ย ย ย </div>
ย ย ย ย ย ย <div class="modal-body">
ย ย ย ย ย ย ย ย <div class="form-grid">
ย ย ย ย ย ย ย ย ย ย <div class="input-group full-width">
ย ย ย ย ย ย ย ย ย ย ย ย <label for="modal-nome">Nome</label>
ย ย ย ย ย ย ย ย ย ย ย ย <input type="text" id="modal-nome" class="input-field">
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย <div class="input-group">
ย ย ย ย ย ย ย ย ย ย ย ย <label for="modal-preco">Preรงo (Ex: 19.90)</label>
ย ย ย ย ย ย ย ย ย ย ย ย <input type="number" step="0.01" id="modal-preco" class="input-field">
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย <div class="input-group checkbox-group">
ย ย ย ย ย ย ย ย ย ย ย ย <input type="checkbox" id="modal-pausado">
ย ย ย ย ย ย ย ย ย ย ย ย <label for="modal-pausado">Pausar item (nรฃo aparecerรก no site)</label>
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย </div>

ย ย ย ย ย ย ย ย <div id="modal-lanche-options">
ย ย ย ย ย ย ย ย ย ย <div class="input-group full-width" style="margin-top: 15px;">
ย ย ย ย ย ย ย ย ย ย ย ย <label for="modal-descricao">Descriรงรฃo</label>
ย ย ย ย ย ย ย ย ย ย ย ย <textarea id="modal-descricao" class="input-field"></textarea>
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย <div class="input-group full-width" style="margin-top: 15px;">
ย ย ย ย ย ย ย ย ย ย ย ย <label for="modal-imagem">Nome da Imagem (Ex: pernil.jpg)</label>
ย ย ย ย ย ย ย ย ย ย ย ย <input type="text" id="modal-imagem" class="input-field" placeholder="deixe em branco se nรฃo tiver">
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย <div class="options-title">โ Ingredientes (para "Remover")</div>
ย ย ย ย ย ย ย ย ย ย <p style="color: #9ca3af; font-size: 0.9rem; margin-bottom: 10px;">Marque os ingredientes que este lanche POSSUI, para o cliente poder removรช-los.</p>
ย ย ย ย ย ย ย ย ย ย <div class="options-grid" id="modal-remocoes-container">
ย ย ย ย ย ย ย ย ย ย ย ย </div>

ย ย ย ย ย ย ย ย ย ย <div class="options-title">๐๏ธ Dias Especiais (Ex: Sรณ Hoje)</div>
ย ย ย ย ย ย ย ย ย ย <p style="color: #9ca3af; font-size: 0.9rem; margin-bottom: 10px;">Deixe todos desmarcados para o lanche aparecer sempre.</p>
ย ย ย ย ย ย ย ย ย ย <div class="options-grid" id="modal-dias-container">
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย </div>

ย ย ย ย ย ย ย ย <div id="modal-bebida-options">
ย ย ย ย ย ย ย ย ย ย <div class="input-group full-width" style="margin-top: 15px;">
ย ย ย ย ย ย ย ย ย ย ย ย <label for="modal-sabores">Sabores (separados por vรญrgula)</label>
ย ย ย ย ย ย ย ย ย ย ย ย <input type="text" id="modal-sabores" class="input-field" placeholder="Normal, Zero Aรงรบcar">
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย <div class="input-group full-width" style="margin-top: 15px;">
ย ย ย ย ย ย ย ย ย ย ย ย <label for="modal-bebida-imagem">Nome da Imagem (Ex: coca.jpg)</label>
ย ย ย ย ย ย ย ย ย ย ย ย <input type="text" id="modal-bebida-imagem" class="input-field" placeholder="deixe em branco se nรฃo tiver">
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย </div>

ย ย ย ย ย ย ย ย <input type="hidden" id="modal-edit-id">
ย ย ย ย ย ย ย ย <input type="hidden" id="modal-edit-tipo">
ย ย ย ย ย ย </div>
ย ย ย ย ย ย <div class="modal-footer">
ย ย ย ย ย ย ย ย <button class="btn-delete" onclick="handleDelete()">Excluir Item</button>
ย ย ย ย ย ย ย ย <button class="btn-save" onclick="handleSave()">Salvar</button>
ย ย ย ย ย ย </div>
ย ย ย ย </div>
ย ย ย </div>


ย ย <script type="module">
ย ย ย ย import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
ย ย ย ย import { getDatabase, ref, push, get, set, remove, onChildAdded, onChildChanged, onChildRemoved } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-database.js";
ย ย ย ย 
ย ย ย ย // REMOVEMOS A AUTENTICAรรO PARA PERMITIR TRABALHO IMEDIATO
ย ย ย ย // import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-auth.js";

ย ย ย ย // SUA MESMA CONFIGURAรรO
ย ย ย ย const firebaseConfig = {
ย ย ย ย ย ย apiKey: "AIzaSyAQTm3cL26REQloN8AFP28gwsIUzYz73og",
ย ย ย ย ย ย authDomain: "dona-baguete-kds.firebaseapp.com",
ย ย ย ย ย ย databaseURL: "https://dona-baguete-kds-default-rtdb.firebaseio.com",ย
ย ย ย ย ย ย projectId: "dona-baguete-kds",
ย ย ย ย ย ย storageBucket: "dona-baguete-kds.firebasestorage.app",
ย ย ย ย ย ย messagingSenderId: "307283406823",
ย ย ย ย ย ย appId: "1:307283406823:web:a7d1761f0b4550cae59742",
ย ย ย ย ย ย measurementId: "G-NY4NTLFLCG"
ย ย ย ย };
ย ย ย ยย
ย ย ย ย // Inicializa o App e o Database
ย ย ย ย const app = initializeApp(firebaseConfig);
ย ย ย ย const database = getDatabase(app);
ย ย ย ย // Removido: const auth = getAuth(app);
ย ย ย ยย
ย ย ย ย // NOVOS CAMINHOS no Firebase
ย ย ย ย const lanchesRef = ref(database, 'cardapio/lanches');
ย ย ย ย const bebidasRef = ref(database, 'cardapio/bebidas');

ย ย ย ย // --- DADOS PARA MIGRAรรO (Cardรกpio base) ---
ย ย ย ย const lanches_antigos = [
ย ย ย ย ย ย { nome: 'CLรSSICO PERNIL', descricao: 'Pernil desfiado no tempero da casa, queijo prato ou mussarela derretido, salada de repolho crocante, vinagrete de tomate e cebola, maionese no pรฃo baguete.', preco: 19.90, ingredientesBase: ['queijo', 'repolho-maionese', 'tomate', 'maionese'], imagem: 'pernil.jpg' },
ย ย ย ย ย ย { nome: 'FRANGO CREMOSO', descricao: 'Frango desfiado temperado, Catupiry original cremoso, bacon, vinagrete de tomate e cebola no pรฃo baguete.', preco: 21.90, ingredientesBase: ['catupiry', 'bacon', 'tomate'], imagem: 'frango.jpg' },
ย ย ย ย ย ย { nome: 'COSTELA ESPECIAL', descricao: 'Costela bovina desfiada e suculenta, queijo prato ou mussarela derretido, molho barbecue, vinagrete de tomate e cebola no pรฃo baguete.', preco: 21.90, ingredientesBase: ['queijo', 'tomate'], imagem: 'costela.jpg' },
             { nome: '๐ฅ VEGANO BACON', descricao: 'Bacon vegano crocante, queijo vegano, molho especial e alface.', preco: 25.50, ingredientesBase: ['queijo', 'bacon', 'maionese'], imagem: 'vegano.jpg' },
ย ย ย ย ];
ย ย ย ย const bebidas_antigas = [
ย ย ย ย ย ย { nome: 'Coca-Cola Lata 350ml', preco: 6.00, sabores: ['Normal', 'Zero Aรงรบcar'], imagem: 'coca-lata.jpg' },
ย ย ย ย ย ย { nome: 'Refrigerante Bellpar 600ml', preco: 5.00, sabores: ['Conch-Cola', 'Tubaรญna', 'Guaranรก'], imagem: 'bellpar-600.jpg' },
ย ย ย ย ย ย { nome: 'Coca-Cola 2L', preco: 15.00, sabores: ['Normal', 'Zero Aรงรบcar'], imagem: 'coca-2l.jpg' },
ย ย ย ย ย ย { nome: 'รgua Mineral', preco: 3.00, imagem: 'agua.jpg' }
ย ย ย ย ];
ย ย ย ย // Lista de todas as remoรงรตes possรญveis (para o modal)
ย ย ย ย const todas_remocoes = [
ย ย ย ย ย ย { id: 'bacon', nome: 'Bacon' },ย
ย ย ย ย ย ย { id: 'queijo', nome: 'Queijo' },ย
ย ย ย ย ย ย { id: 'catupiry', nome: 'Catupiry' },
ย ย ย ย ย ย { id: 'tomate', nome: 'Vinagrete (Tomate e Cebola)' },ย
ย ย ย ย ย ย { id: 'maionese', nome: 'Maionese' },ย
ย ย ย ย ย ย { id: 'repolho-maionese', nome: 'Repolho c/ Maionese' },
ย ย ย ย ย ย { id: 'rucula', nome: 'Rรบcula' }
ย ย ย ย ];
ย ย ย ย const dias_semana = ['Domingo (0)', 'Segunda (1)', 'Terรงa (2)', 'Quarta (3)', 'Quinta (4)', 'Sexta (5)', 'Sรกbado (6)'];
ย ย ย ย // --- FIM DOS DADOS DE MIGRAรรO ---

        // --- SUBSTITUรMOS O VIGIA DE LOGIN PELA INICIALIZAรรO DIRETA ---
ย ย ย ย document.addEventListener('DOMContentLoaded', () => {
             // Opcional: Aqui vocรช pode adicionar um check de login futuro
             initPage();
        });
        
ย ย ย ย // O botรฃo de logout agora apenas leva ร pรกgina de login
ย ย ย ย 
ย ย ย ย // --- INICIALIZAรรO DA PรGINA ---
ย ย ย ย async function initPage() {
ย ย ย ย ย ย popularModalOptions();
ย ย ย ย ย ย await migrateMenuIfNeeded();
ย ย ย ย ย ยย
ย ย ย ย ย ย document.getElementById('loading-msg').style.display = 'none';
ย ย ย ย ย ย document.querySelector('.cardapio-manager').style.display = 'grid';
ย ย ย ย ย ยย
ย ย ย ย ย ย attachListeners();
ย ย ย ย }

ย ย ย ย // 1. MIGRAรรO (Roda sรณ na primeira vez)
ย ย ย ย async function migrateMenuIfNeeded() {
ย ย ย ย ย ย try {
ย ย ย ย ย ย ย ย const lanchesSnap = await get(lanchesRef);
ย ย ย ย ย ย ย ย // Se nรฃo existir ou estiver vazio, faz a migraรงรฃo
ย ย ย ย ย ย ย ย if (!lanchesSnap.exists() || Object.keys(lanchesSnap.val()).length === 0) {
ย ย ย ย ย ย ย ย ย ย console.log("Migrando lanches antigos para o Firebase...");
ย ย ย ย ย ย ย ย ย ย for (const lanche of lanches_antigos) {
ย ย ย ย ย ย ย ย ย ย ย ย await push(lanchesRef, lanche);
ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย const bebidasSnap = await get(bebidasRef);
ย ย ย ย ย ย ย ย if (!bebidasSnap.exists() || Object.keys(bebidasSnap.val()).length === 0) {
ย ย ย ย ย ย ย ย ย ย console.log("Migrando bebidas antigas para o Firebase...");
ย ย ย ย ย ย ย ย ย ย for (const bebida of bebidas_antigas) {
ย ย ย ย ย ย ย ย ย ย ย ย await push(bebidasRef, bebida);
ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย } catch (e) {
ย ย ย ย ย ย ย ย console.error("Erro na migraรงรฃo: ", e);
ย ย ย ย ย ย ย ย alert("Erro ao migrar o cardรกpio inicial. Verifique as regras de escrita (WRITE).");
ย ย ย ย ย ย }
ย ย ย ย }

ย ย ย ย // 2. OUVINTES (Listeners)
ย ย ย ย function attachListeners() {
ย ย ย ย ย ย // Lanches
ย ย ย ย ย ย onChildAdded(lanchesRef, (snapshot) => renderItemCard(snapshot, 'lanche'));
ย ย ย ย ย ย onChildChanged(lanchesRef, (snapshot) => renderItemCard(snapshot, 'lanche'));
ย ย ย ย ย ย onChildRemoved(lanchesRef, (snapshot) => {
ย ย ย ย ย ย ย ย const el = document.getElementById(snapshot.key);
ย ย ย ย ย ย ย ย if (el) el.remove();
ย ย ย ย ย ย });

ย ย ย ย ย ย // Bebidas
ย ย ย ย ย ย onChildAdded(bebidasRef, (snapshot) => renderItemCard(snapshot, 'bebida'));
ย ย ย ย ย ย onChildChanged(bebidasRef, (snapshot) => renderItemCard(snapshot, 'bebida'));
ย ย ย ย ย ย onChildRemoved(bebidasRef, (snapshot) => {
ย ย ย ย ย ย ย ย const el = document.getElementById(snapshot.key);
ย ย ย ย ย ย ย ย if (el) el.remove();
ย ย ย ย ย ย });
ย ย ย ย }
ย ย ย ยย
ย ย ย ย // 3. RENDERIZAรรO
ย ย ย ย function renderItemCard(snapshot, tipo) {
ย ย ย ย ย ย const id = snapshot.key;
ย ย ย ย ย ย const item = snapshot.val();
ย ย ย ย ย ย const containerId = (tipo === 'lanche') ? 'lanches-lista' : 'bebidas-lista';
ย ย ย ย ย ย const container = document.getElementById(containerId);
ย ย ย ย ย ยย
ย ย ย ย ย ย let existingCard = document.getElementById(id);
ย ย ย ย ย ย if (!existingCard) {
ย ย ย ย ย ย ย ย existingCard = document.createElement('div');
ย ย ย ย ย ย ย ย existingCard.id = id;
ย ย ย ย ย ย ย ย container.appendChild(existingCard);
ย ย ย ย ย ย }
ย ย ย ย ย ยย
ย ย ย ย ย ย existingCard.className = `item-card ${item.pausado ? 'pausado' : ''}`;
ย ย ย ย ย ย existingCard.innerHTML = `
ย ย ย ย ย ย ย ย <div class="item-info">
ย ย ย ย ย ย ย ย ย ย <span class="nome">${item.nome} ${item.pausado ? '<span class="pausado-tag">PAUSADO</span>' : ''}</span>
ย ย ย ย ย ย ย ย ย ย <span class="preco">R$ ${Number(item.preco).toFixed(2).replace('.', ',')}</span>
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย <button class="btn-edit" onclick="openModal('${tipo}', '${id}')">Editar</button>
ย ย ย ย ย ย `;
ย ย ย ย }

ย ย ย ย // --- LรGICA DO MODAL (FUNรรES GLOBAIS) ---
ย ย ย ยย
ย ย ย ย window.openModal = async (tipo, id = null) => {
ย ย ย ย ย ย const modal = document.getElementById('modal');
ย ย ย ย ย ยย
ย ย ย ย ย ย // Reseta o formulรกrio (MUITO IMPORTANTE)
ย ย ย ย ย ย document.getElementById('modal-nome').value = '';
ย ย ย ย ย ย document.getElementById('modal-preco').value = '';
ย ย ย ย ย ย document.getElementById('modal-descricao').value = '';
ย ย ย ย ย ย document.getElementById('modal-sabores').value = '';
ย ย ย ย ย ย document.getElementById('modal-imagem').value = '';ย
ย ย ย ย ย ย document.getElementById('modal-bebida-imagem').value = ''; 
ย ย ย ย ย ย document.getElementById('modal-pausado').checked = false;
ย ย ย ย ย ย document.querySelectorAll('#modal-remocoes-container input').forEach(cb => cb.checked = false);
ย ย ย ย ย ย document.querySelectorAll('#modal-dias-container input').forEach(cb => cb.checked = false);
ย ย ย ย ย ยย
ย ย ย ย ย ย document.getElementById('modal-edit-id').value = id;
ย ย ย ย ย ย document.getElementById('modal-edit-tipo').value = tipo;

ย ย ย ย ย ย // Mostra/esconde campos especรญficos
ย ย ย ย ย ย document.getElementById('modal-lanche-options').style.display = (tipo === 'lanche') ? 'block' : 'none';
ย ย ย ย ย ย document.getElementById('modal-bebida-options').style.display = (tipo === 'bebida') ? 'block' : 'none';
ย ย ย ย ย ยย
ย ย ย ย ย ย if (id) {
ย ย ย ย ย ย ย ย // EDITANDO
ย ย ย ย ย ย ย ย document.getElementById('modal-title').textContent = (tipo === 'lanche') ? 'Editar Lanche' : 'Editar Bebida';
ย ย ย ย ย ย ย ย document.querySelector('.btn-delete').style.display = 'block';
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย const itemRef = ref(database, `cardapio/${tipo}s/${id}`);
ย ย ย ย ย ย ย ย const snapshot = await get(itemRef);
ย ย ย ย ย ย ย ย const item = snapshot.val();
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย document.getElementById('modal-nome').value = item.nome;
ย ย ย ย ย ย ย ย document.getElementById('modal-preco').value = item.preco;
ย ย ย ย ย ย ย ย document.getElementById('modal-pausado').checked = item.pausado || false;
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย if (tipo === 'lanche') {
ย ย ย ย ย ย ย ย ย ย document.getElementById('modal-descricao').value = item.descricao || '';
ย ย ย ย ย ย ย ย ย ย document.getElementById('modal-imagem').value = item.imagem || '';ย
ย ย ย ย ย ย ย ย ย ย // Marca os checkboxes de remoรงรตes
ย ย ย ย ย ย ย ย ย ย if (item.ingredientesBase) {
ย ย ย ย ย ย ย ย ย ย ย ย item.ingredientesBase.forEach(ingId => {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย const cb = document.getElementById(`rem-${ingId}`);
ย ย ย ย ย ย ย ย ย ย ย ย ย ย if (cb) cb.checked = true;
ย ย ย ย ย ย ย ย ย ย ย ย });
ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย ย ย // Marca os checkboxes de dias
ย ย ย ย ย ย ย ย ย ย if (item.diasEspeciais) {
ย ย ย ย ย ย ย ย ย ย ย ย item.diasEspeciais.forEach(dia => {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย const cb = document.getElementById(`dia-${dia}`);
ย ย ย ย ย ย ย ย ย ย ย ย ย ย if (cb) cb.checked = true;
ย ย ย ย ย ย ย ย ย ย ย ย });
ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย ย ย // Preenche sabores
ย ย ย ย ย ย ย ย ย ย document.getElementById('modal-sabores').value = (item.sabores || []).join(', ');
ย ย ย ย ย ย ย ย ย ย document.getElementById('modal-bebida-imagem').value = item.imagem || '';
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย // ADICIONANDO
ย ย ย ย ย ย ย ย document.getElementById('modal-title').textContent = (tipo === 'lanche') ? 'Adicionar Lanche' : 'Adicionar Bebida';
ย ย ย ย ย ย ย ย document.querySelector('.btn-delete').style.display = 'none'; // Esconde o botรฃo de excluir
ย ย ย ย ย ย }
ย ย ย ย ย ยย
ย ย ย ย ย ย modal.classList.add('active');
ย ย ย ย }

ย ย ย ย window.closeModal = () => {
ย ย ย ย ย ย document.getElementById('modal').classList.remove('active');
ย ย ย ย }
ย ย ย ยย
ย ย ย ย window.handleSave = async () => {
ย ย ย ย ย ย const id = document.getElementById('modal-edit-id').value;
ย ย ย ย ย ย const tipo = document.getElementById('modal-edit-tipo').value;
ย ย ย ย ย ย const containerRef = (tipo === 'lanche') ? lanchesRef : bebidasRef;
ย ย ย ย ย ยย
ย ย ย ย ย ย let precoInput = document.getElementById('modal-preco').value.replace(',', '.');
ย ย ย ย ย ยย
ย ย ย ย ย ย let itemData = {
ย ย ย ย ย ย ย ย nome: document.getElementById('modal-nome').value,
ย ย ย ย ย ย ย ย preco: Number(precoInput),
ย ย ย ย ย ย ย ย pausado: document.getElementById('modal-pausado').checked
ย ย ย ย ย ย };
ย ย ย ย ย ยย
ย ย ย ย ย ย if (tipo === 'lanche') {
ย ย ย ย ย ย ย ย // Salva dados do lanche
ย ย ย ย ย ย ย ย itemData.descricao = document.getElementById('modal-descricao').value;
ย ย ย ย ย ย ย ย itemData.imagem = document.getElementById('modal-imagem').value;ย
ย ย ย ย ย ย ย ย // Pega as remoรงรตes marcadas
ย ย ย ย ย ย ย ย itemData.ingredientesBase = Array.from(document.querySelectorAll('#modal-remocoes-container input:checked'))
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย .map(cb => cb.value);
ย ย ย ย ย ย ย ย // Pega os dias marcados
ย ย ย ย ย ย ย ย itemData.diasEspeciais = Array.from(document.querySelectorAll('#modal-dias-container input:checked'))
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย .map(cb => Number(cb.value));
ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย // Salva dados da bebida
ย ย ย ย ย ย ย ย itemData.sabores = document.getElementById('modal-sabores').value
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย .split(',')
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย .map(s => s.trim())
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย .filter(s => s); // Remove strings vazias
ย ย ย ย ย ย ย ย itemData.imagem = document.getElementById('modal-bebida-imagem').value;
ย ย ย ย ย ย }
ย ย ย ย ย ยย
ย ย ย ย ย ย try {
ย ย ย ย ย ย ย ย if (id) {
ย ย ย ย ย ย ย ย ย ย // Atualiza
ย ย ย ย ย ย ย ย ย ย await set(ref(database, `cardapio/${tipo}s/${id}`), itemData);
ย ย ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย ย ย // Cria
ย ย ย ย ย ย ย ย ย ย await push(containerRef, itemData);
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย closeModal();
ย ย ย ย ย ย } catch (e) {
ย ย ย ย ย ย ย ย console.error("Erro ao salvar: ", e);
ย ย ย ย ย ย ย ย alert("Erro ao salvar o item. Verifique as regras de escrita no Firebase (WRITE).");
ย ย ย ย ย ย }
ย ย ย ย }
ย ย ย ยย
ย ย ย ย window.handleDelete = async () => {
ย ย ย ย ย ย const id = document.getElementById('modal-edit-id').value;
ย ย ย ย ย ย const tipo = document.getElementById('modal-edit-tipo').value;
ย ย ย ย ย ย const nome = document.getElementById('modal-nome').value;

ย ย ย ย ย ย if (confirm(`Tem certeza que quer excluir o item "${nome}"? \n\nIsso nรฃo pode ser desfeito.`)) {
ย ย ย ย ย ย ย ย try {
ย ย ย ย ย ย ย ย ย ย await remove(ref(database, `cardapio/${tipo}s/${id}`));
ย ย ย ย ย ย ย ย ย ย closeModal();
ย ย ย ย ย ย ย ย } catch (e) {
ย ย ย ย ย ย ย ย ย ย console.error("Erro ao excluir: ", e);
ย ย ย ย ย ย ย ย ย ย alert("Erro ao excluir o item. Verifique as regras de escrita no Firebase (WRITE).");
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย }
ย ย ย ย }

ย ย ย ย function popularModalOptions() {
ย ย ย ย ย ย // Popula os checkboxes de remoรงรตes
ย ย ย ย ย ย const remContainer = document.getElementById('modal-remocoes-container');
ย ย ย ย ย ย remContainer.innerHTML = todas_remocoes.map(rem => `
ย ย ย ย ย ย ย ย <div class="checkbox-group">
ย ย ย ย ย ย ย ย ย ย <input type="checkbox" id="rem-${rem.id}" value="${rem.id}">
ย ย ย ย ย ย ย ย ย ย <label for="rem-${rem.id}">${rem.nome}</label>
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย `).join('');

ย ย ย ย ย ย // Popula os checkboxes de dias da semana
ย ย ย ย ย ย const diasContainer = document.getElementById('modal-dias-container');
ย ย ย ย ย ย diasContainer.innerHTML = dias_semana.map((nome, index) => `
ย ย ย ย ย ย ย ย <div class="checkbox-group">
ย ย ย ย ย ย ย ย ย ย <input type="checkbox" id="dia-${index}" value="${index}">
ย ย ย ย ย ย ย ย ย ย <label for="dia-${index}">${nome}</label>
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย `).join('');
ย ย ย ย }

ย ย </script>
</body>
</html>
